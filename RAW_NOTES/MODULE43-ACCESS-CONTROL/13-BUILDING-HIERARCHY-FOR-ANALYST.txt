




NESSA AULA, VEREMOS COMO CONSTRUIR 1 HIERARQUIA,


DO PONTO DE VISTA DE 1 ANALYST....











-->  PARA O ANALYST,



CRIAREMOS OUTRO ROLE DE "ACCESS CONTROL",




CHAMADO DE 



"STAGING_READ",



E OUTRO,


"TARGET_READ"....













--> PARA ESSES ROLES,



FAZEMOS GRANT DE "READ-ONLY" (SELECT)


NAS TABLES "STAGING" E "TARGET"...

















--> tAMBÉM ENTREGAMOS ACESSO AO SCHEMA DE "SANDBOX",


ATRAVÉS DO "SANDBOX_ROLE"... (
    para que ele possa criar tables e testar queries...
)











-->  VAMOS RODAR O MESMO SET DE COMANDOS QUE 


RODAMOS PARA O "DEVELOPER",

começando por estes:












USE ROLE SECURITYADMIN;




CREATE ROLE STAGING_READ; ---- access control role 
CREATE ROLE TARGET_READ;  ---- access control role
CREATE ROLE ANALYST; -- functional role 










--> ISSO FEITO, VINCULAMOS ESSES ROLES

AO ROLE DE "SCHEMAADMIN"....








EX:






GRANT ROLE STAGING_READ TO ROLE SCHEMAADMIN;
GRANT ROLE TARGET_READ TO ROLE SCHEMAADMIN;














TAMBÉM VINCULAMOS ESSE ROLE AO "SYSADMIN", para manter a hierarquia:






GRANT ROLE ANALYST TO ROLE SYSADMIN;














--> TROCAMOS PARA O SYSADMIN,

PARA AÍ ENTREGARMOS USAGE NA DATABASE  E SCHEMAS A ESSES ROLES...







ex:






USE ROLE SYSADMIN;

GRANT USAGE ON DATABASE SALESDB TO ROLE STAGING_READ;
GRANT USAGE ON SCHEMA STAGING TO ROLE STAGING_READ;
GRANT SELECT ON ALL TABLES IN SCHEMA SALESDB.STAGING TO ROLE STAGING_READ;



GRANT USAGE ON DATABASE SALESDB TO ROLE TARGET_READ;
GRANT USAGE ON SCHEMA SALESDB.TARGET TO ROLE TARGET_READ;
GRANT SELECT ON ALL TABLES IN SCHEMA SALESDB.TARGET TO ROLE TARGET_READ;



GRANT ROLE STAGING_READ TO ROLE ANALYST;
GRANT ROLE TARGET_READ TO ROLE ANALYST;










COM ISSO, ASSIGNAMOS ESSES 2 ROLES, DE ACESSO, 

AO ROLE FUNCTIONAL DE "ANALYST"...















DEPOIS DISSO, PODEMOS FAZER "USE" DESSE 


ROLE DE ANALYST,




E AÍ PODEMOS QUERIAR A TABLE DE EMPLOYEES NO SCHEMA DE
 
 "STAGING"..





 ex:






 USE ROLE ANALYST;



 SELECT * FROM "SALESDB"."STAGING"."STAGING_EMPLOYEE_TABLE";



















 É ASSIM QUE FORMAMOS ESSA HIERARQUIA,


 PARA O ROLE DE "ANALYST"...











 O QUE TEMOS QUE APRENDER, AQUI,




 É "SEGUIR AS REGRAS"...








1) NUNCA ASSIGNE USERS AOS "ACCESS CONTROL ROLES" (como STAGING_ROLE, TARGET_ROLE, SANDBOX_ROLE)...


2) SEMPRE DEVEMOS ASSIGNAR USERS APENAS AOS "FUNCTIONAL ROLES" (
    que, por sua vez, terao os "access control roles" assignados 
    a si...
)

3) SIMILARMENTE,
    PRIVILEGES SEMPRE DEVEM SER __ ENCAPSULATED_ 

    EM ACCESS CONTROL ROLES...

    (nunca faça grant dos privileges diretamente a esses functional 
    roles)


4) FUNCTIONAL ROLES DEVEM APENAS SE REFERIR A ESSES ACCESS CONTROL
ROLES PARA CONSEGUIR ACCESS PRIVILEGES...









--> antes de criar ROLES DE "ACCESS CONTROL",

sempre fale com seu manager, peça 


""COMO ELES ENXERGAM ESSA DATABASE"",


da perspectiva deles...









--> A PARTIR DE DISCUSSOES,

VOCE PODE CRIAR ACCESS CONTROL ROLES,

E ENTAO OS ASSIGNAR 

NOS FUNCTIONAL ROLES...





--> E SEMPRE TENTE __ MANTER 

ESSES FUNCTIONAL ROLES 

"AS FLAT AS POSSIBLE" (

    nao crie 1 hierarquia mt complexa, a partir 

    desses functional roles..
)





--> VOCE PODE PENSAR BASTANTE SOBRE COMO DIVIDIR 
SEU ACESSO,
COM ESSES ACCESS CONTROL ROLES.. --> E, SE POSSÍVEL,

VC TAMBÉM PODE CRIAR 

1 HIERARQUIA 
A PARTIR 


DESSES ACCESS CONTROL ROLES,

E ENTAO 

OS ASSIGNAR 

DE VOLTA AOS FUNCTIONAL ROLES...